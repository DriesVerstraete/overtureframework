%=======================================================================================================
% Beam Models for Overture and cg 
%=======================================================================================================

% -- article: 
\documentclass[11pt]{article}
% \usepackage[bookmarks=true]{hyperref}
\usepackage[bookmarks=true,colorlinks=true,linkcolor=blue]{hyperref}

% \input documentationPageSize.tex
\hbadness=10000 
\sloppy \hfuzz=30pt

\usepackage{calc}
\usepackage[lmargin=1.in,rmargin=1.in,tmargin=1.in,bmargin=1.in]{geometry}

\input homeHenshaw


\input wdhDefinitions.tex

\newcommand{\tableFont}{\footnotesize}
\newcommand{\num}[2]{#1e#2} % Use this macro to define the format of the numbers in the table
\newcommand{\eem}{e^{(j)}}
\newcommand{\rateLabel}{rate}



% \input{pstricks}\input{pst-node}
% \input{colours}

\newcommand{\bogus}[1]{}  % begin a section that will not be printed

\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{graphicx}

% --------------------------------------------
% NOTE: trouble with tikz and program package ??
\usepackage{tikz}

\input trimFig.tex


% \usepackage{verbatim}
% \usepackage{moreverb}
% \usepackage{graphics}    
% \usepackage{epsfig}    
% \usepackage{calc}
% \usepackage{ifthen}
% \usepackage{float}
% \usepackage{fancybox}

% define the clipFig commands:
% \input clipFig.tex

\newcommand{\obDir}{\homeHenshaw/res/OverBlown}
\newcommand{\ogenDir}{\homeHenshaw/Overture/ogen}

% \newcommand{\grad}{\nabla}
% \newcommand{\half}{\frac{1}{2}}}

\newcommand{\eps}{\epsilon}
\newcommand{\zerov}{\mathbf{0}}

\newcommand{\bc}[1]{\mbox{\bf#1}}   % bold name
\newcommand{\cc}[1]{\mbox{  : #1}}  % comment

\newcommand{\Overture}{{Overture}}

\newcommand{\Largebf}{\sffamily\bfseries\Large}
\newcommand{\largebf}{\sffamily\bfseries\large}
\newcommand{\largess}{\sffamily\large}
\newcommand{\Largess}{\sffamily\Large}
\newcommand{\bfss}{\sffamily\bfseries}
\newcommand{\smallss}{\sffamily\small}
\newcommand{\normalss}{\sffamily}
\newcommand{\scriptsizess}{\sffamily\scriptsize}

\newcommand{\Div}{\grad\cdot}
\newcommand{\tauv}{\boldsymbol{\tau}}
\newcommand{\thetav}{\boldsymbol{\theta}}

\newcommand{\Omegav}{\boldsymbol{\Omega}}
\newcommand{\omegav}{\boldsymbol{\omega}}
\newcommand{\cm}{{\rm cm}}

\newcommand{\sumi}{\sum_{i=1}^n}
% \newcommand{\half}{{1\over2}}
\newcommand{\dt}{{\Delta t}}


\newcommand{\Gc}{\mathcal{G}}
\newcommand{\Fc}{\mathcal{F}}
\newcommand{\sgn}{\operatorname{sgn}}

\renewcommand{\url}[1]{Available from www.OvertureFramework.org}

\newcommand{\rhos}{\bar{\rho}}
\newcommand{\hs}{\bar{h}}
\newcommand{\bs}{\bar{b}}
\newcommand{\As}{\bar{A}}
\newcommand{\Ts}{\bar{T}}
\newcommand{\Ls}{\bar{L}}
\newcommand{\wt}{\dot{w}}

\newcommand{\xbv}{\xv_b}
\newcommand{\nsv}{\nv_b}
\newcommand{\sigmav}{\boldsymbol{\sigma}}

% \psset{xunit=1.cm,yunit=1.cm,runit=1.cm}


% *** See http://www.eng.cam.ac.uk/help/tpl/textprocessing/squeeze.html
% By default, LaTeX doesn't like to fill more than 0.7 of a text page with tables and graphics, nor does it like too many figures per page. This behaviour can be changed by placing lines like the following before \begin{document}

\renewcommand\floatpagefraction{.9}
\renewcommand\topfraction{.9}
\renewcommand\bottomfraction{.9}
\renewcommand\textfraction{.1}   
\setcounter{totalnumber}{50}
\setcounter{topnumber}{50}
\setcounter{bottomnumber}{50}


\begin{document}

\vglue 5\baselineskip
\begin{flushleft}
{\LARGE Beam Models for Overture and CG} \\
\vspace{2\baselineskip}
William D. Henshaw, \\
Department of Mathematical Sciences, \\
Rensselaer Polytechnic Institute,     \\
Troy, NY, 12180.  \\
www.overtureFramework.org \\
\vspace{2\baselineskip}
\today
\vspace{4\baselineskip}
% 
\end{flushleft}
%
%
\noindent{\bf Abstract:} This article provides background and documentation for
the beam models that have been developed for use with Overture and the CG suite of partial differential
equation solvers. The topics covered include
\begin{description}
  \item[BeamModel] : a class that implements an Euler-Bernoulli beam.
  \item[NonLinearBeamModel] : a non-linear beam model.
\end{description}


% ----------------------------------------------------
\clearpage
\tableofcontents
\section{Acknowledgements}

Thanks to Dr. Alex Main for developing the first version of the BeamModel and NonLinearBeamModel classes while
a summer student at LLNL in 2013.

% --------------------------------------------------------------------------------------------------------------------
% --------------------------------------------------------------------------------------------------------------------
% --------------------------------------------------------------------------------------------------------------------
\section{Class BeamModel}\label{sec:BeamModel}

The BeamModel class defines a generalized Euler-Bernoulli (EB) beam,
\begin{align}
  \rhos \As \frac{\partial^2 w}{\partial t^2} = 
                    & -K_0 w +
                   \frac{\partial}{\partial x}\left( T \frac{\partial w}{\partial x}\right)
                   - \frac{\partial^2}{\partial x^2}\left( E I \frac{\partial^2 w}{\partial x^2}\right) \\
              &    - K_{t} \wt
                   + K_{xxt} \frac{\partial^2 \wt}{\partial x^2}
                   - K_{xxxxt} \frac{\partial^4 \wt}{\partial x^4}
                   + f(x,t), 
                  \qquad\qquad x\in[0,\Ls], \quad t\ge 0,  \label{eq:BeamModel}
\end{align}
where $y=w(x,t)$ is the displacement of the beam, $\wt=\partial w/\partial t$ is the beam velocity,  
$\As$ is the cross-sectional area of the beam ($\As=\hs\bs$ for a beam of constant thickness, $\hs$ and constant breadth $\bs$ in the z-direction), 
$\rhos$ is the beam density, $\Ls$ is the length of the beam, 
$E$ is Young's modulus, $I$ is the area-moment of inertial (e.g. $I=\frac{1}{12} h^3 b$ for a rectangular beam),
 $T$ is the {\em tension} coefficient and $K_0$ is the linear stiffiness coefficient.
The terms with coefficients $K_{xxt}$ and $K_{xxxxt}$ are so-called {\em visco-elastic} damping terms;
these terms can also be added to provide artificial dissipation to smooth the numerical solution.  
% 
The EB beam is generally consider valid for thin beams and small slopes,  $|w_x| \ll 1$.


A variational form of the problem is found by multiplying by $v$ and integrating over the domain with inner product,
\begin{align}
   (v,w)_B \equiv \int_0^{\Ls} v \, w \, dx. 
\end{align}
After integration by parts the result is 
\begin{align}
 \left( v,  \rhos \As \frac{\partial^2 w}{\partial t^2} \right)_B  &= 
                  - \left( v , K_0 w \right)_B
                  - \left( \frac{\partial v}{\partial x} , T \frac{\partial w}{\partial x} \right)_B
                  -\left(\frac{\partial^2 v}{\partial x^2}, E I \frac{\partial^2 w}{\partial x^2}\right)_B  \\
            & - K_{t} \left( v ,\wt \right)_B
              - K_{xxt} \left( \frac{\partial v}{\partial x} ,\frac{\partial \wt}{\partial x} \right)_B
              - K_{xxxxt} \left( \frac{\partial^2 v}{\partial x^2} ,\frac{\partial^2 \wt}{\partial x^2} \right)_B
             + ( v, f(x,t))_B \\
% boundary terms
             &\quad  +   \Big[ v T \frac{\partial w}{\partial x} 
                      ~ + K_{xxt}v  \frac{\partial \wt}{\partial x}
                      ~ -K_{xxxxt} v \frac{\partial^3 \wt}{\partial x^3} 
                      ~ + K_{xxxxt} \frac{\partial v}{\partial x}\frac{\partial^2 \wt}{\partial x^2}\Big)  \\
              &\qquad\quad -v \frac{\partial}{\partial x}\Big( E I \frac{\partial^2 w}{\partial x^2}\Big) 
                      ~ + \frac{\partial v}{\partial x}E I \frac{\partial^2 w}{\partial x^2}\Big)  
                      \Big]_0^{\Ls}   \label{eq:beamBoundaryTerms}
\end{align}

The boundary terms in~\eqref{eq:beamBoundaryTerms} indicate some valid combinations of boundary conditions that will given an energy estimate
when $v=w$ (e.g. if all the boundary terms vanish when the forcing functions $g_m$, $h_m$, $M$ and $S$, given below, are all zero). 
For example, the following three options are common boundary conditions (BC's), 
\begin{align}
   \text{clamped BC:}\quad & \quad w(x_m,t)=g_m(t),\quad  w_x(x_m,t)=h_m(t),  \\
   \text{pinned BC:} \quad & \quad w(x_m,t)=g_m(t), \quad E I w_{xx}(x_m,t)=M(t), \\
   \text{free BC:}   \quad & \quad  E I w_{xx}(x_m,t)=M(t), \quad \partial_x( E I w_{xx})(x_m,t)=S(t),
\end{align}
where $x_0=0$ and $x_1=\Ls$ for $m=0,1$, and 
where $M(t)$ is the imposed moment and $S(t)$ the imposed shear force. 
We also see there is a possible fourth choice (not so common ?) which we call a {\em slope} BC, since
the end slope and shear are specified, 
\begin{align}
   \text{slope BC:}\quad & \quad w_x(x_m,t)=g_m(t),\quad  \partial_x( E I w_{xx})(x_m,t)=S(t). 
\end{align}


% --------------------------------------------------------------------------------------------------------------------
\newcommand{\Ne}{N_e}% number of elements 
\newcommand{\Nn}{N_n}% number of nodes
\newcommand{\dx}{\Delta x}
\newcommand{\Mt}{\tilde{M}}
\newcommand{\Kt}{\tilde{K}}
\newcommand{\Bt}{\tilde{B}}
\newcommand{\Bc}{\mathcal{B}}
\subsection{FEM approximation}\label{sec:BeamModelFEM}

We define a FEM approximation for the EB-beam using Hermite polynomials and the Newmark-beta time stepping scheme.
Let $\Ne$ denote the number of elements and $\Nn=\Ne+1$ the number of nodes. 

The FEM representation is taken as 
\begin{align}
  w^h(x,t) = \sum_{j=1}^{\Nn} w_j(t) \phi_j(x) + w_j'(t) \psi_j(x)  = \sum_{j=1}^{\Ne} [ \phi_j(x)\, \psi_j(x)] \begin{bmatrix} w_j(t)\\w_j'(t)\end{bmatrix}
\end{align}
where the degrees of freedom are nodal displacement $w_j(t)$ and the nodal slope $w'_j(t)$, and where $\phi_j(x)$ and $\psi_j(x)$ are 
the cubic Hermite polynomials 
that are non-zero only on $[x_{j-1},x_{j+1}]$,  and
that satisfy,
\begin{align}
  \phi_j(x_i)=\delta_{ij}, ~ \phi_i'(x_j)=0, \\
  \psi_j(x_i)=0, ~ \psi_i'(x_j)=\delta_{ij}.
\end{align}
% 
The Galerkin FEM approximation is defined by the $2\Nn$ equations
\begin{align}
 \left( \chi_i,  \rhos \As \frac{\partial^2 w^h}{\partial t^2} \right)_B  &= 
                  - \left( \chi_i , K_0 w^h \right)_B
                  - \left( \frac{\partial \chi_i}{\partial x} , T \frac{\partial w^h}{\partial x} \right)_B
                  -\left(\frac{\partial^2 \chi_i}{\partial x^2}, E I \frac{\partial^2 w^h}{\partial x^2}\right)_B  \\
              &\quad   
         - K_{t} \left( \chi_i , \wt^h \right)_B
         - K_{xxt} \left( \frac{\partial \chi_i}{\partial x} , \frac{\partial}{\partial t}\frac{\partial w^h}{\partial x} \right)_B
      - K_{xxt} \left( \frac{\partial \chi_i}{\partial x} ,\frac{\partial \wt^h}{\partial x} \right)_B \\
        &\quad   + ( \chi_i, f(x,t))_B \\
% boundary terms
             &\quad  +   \Big[ \chi_i T \frac{\partial w^h}{\partial x} 
                      ~ + K_{xxt} \chi_i \frac{\partial}{\partial t}\frac{\partial w^h}{\partial x} 
                      ~ -K_{xxxxt} \chi_i \frac{\partial^3 \wt^h}{\partial x^3} 
                      ~ + K_{xxxxt} \frac{\partial \chi_i}{\partial x}\frac{\partial^2 \wt^h}{\partial x^2}\Big)  \\
             &\qquad\quad
                      ~ -\chi_i \frac{\partial}{\partial x}\Big( E I \frac{\partial^2 w^h}{\partial x^2}\Big) 
                      ~ + \frac{\partial \chi_i}{\partial x}E I \frac{\partial^2 w^h}{\partial x^2}\Big)  
                      \Big]_0^{\Ls} ,  \label{eq:beamFEM_I}
\end{align}
with $\chi_i=\phi_i$ or $\chi_i=\psi_i$, $i=1,2,\ldots,\Nn$. Written out,
\begin{align}
& \sum_{j=1}^{\Nn} \left\{ M_{ij} \partial_t^2 w_j 
                + \Mt_{ij} \partial_t^2 w'_j \right\}  = 
     - \sum_{j=1}^{\Nn} \left\{  K_{ij} w_j + \Kt_{ij} w'_j 
            ~ + B_{ij} \dot w_j + \Bt_{ij} \dot w'_j \right\} 
                  ~+ ( \phi_i, f(x,t))_B \\
% boundary terms
             &\qquad  +   \Big[ \chi_i T \frac{\partial w^h}{\partial x} 
                      ~ + \chi_i K_{xxt} \frac{\partial \dot w^h}{\partial x} 
%
                      ~ -K_{xxxxt} \chi_i \frac{\partial^3 \wt^h}{\partial x^3} 
                      ~ + K_{xxxxt} \frac{\partial \chi_i}{\partial x}\frac{\partial^2 \wt^h}{\partial x^2}\Big) \\
%
             &\qquad\quad  ~ - \chi_i \frac{\partial}{\partial x}\Big( E I \frac{\partial^2 w^h}{\partial x^2}\Big) 
                      ~ + \frac{\partial \chi_i}{\partial x}E I \frac{\partial^2 w^h}{\partial x^2}\Big)  
                      \Big]_0^{\Ls}  ,  \label{eq:beamFEM_II}
\end{align}
where 
\begin{align}
  M_{ij} &= \left( \chi_i,  \rhos \As \frac{\partial^2 \phi_j}{\partial t^2} \right)_B , \\
  \Mt_{ij} &= \left( \chi_i,  \rhos \As \frac{\partial^2 \psi_j}{\partial t^2} \right)_B , \\
% 
  K_{ij} &= 
             \left( \chi_i , K_0 \phi_j \right)_B
            + \left( \frac{\partial \chi_i}{\partial x} , T \frac{\partial \phi_j}{\partial x} \right)_B
               + \left(\frac{\partial^2 \chi_i}{\partial x^2}, E I \frac{\partial^2 \phi_j}{\partial x^2}\right)_B, \\
  \Kt_{ij} &= \left( \chi_i , K_0 \psi_j \right)_B
                + \left( \frac{\partial \chi_i}{\partial x} , T \frac{\partial \psi_j}{\partial x} \right)_B
                + \left(\frac{\partial^2 \chi_i}{\partial x^2}, E I \frac{\partial^2 \psi_j}{\partial x^2}\right)_B, \\
% 
  B_{ij} &=  K_t \left( \chi_i , \dot\phi_j \right)_B
            + K_{xxt} \left( \frac{\partial \chi_i}{\partial x} , \frac{\partial \dot\phi_j}{\partial x} \right)_B 
            + K_{xxxxt} \left(\frac{\partial^2 \chi_i}{\partial x^2}, \frac{\partial^2 \dot\phi_j}{\partial x^2}\right)_B, \\
% 
  \Bt_{ij} &=  K_t \left( \chi_i , \dot\psi_j \right)_B
            + K_{xxt} \left( \frac{\partial \chi_i}{\partial x} , \frac{\partial \dot\psi_j}{\partial x} \right)_B
            + K_{xxxxt} \left(\frac{\partial^2 \chi_i}{\partial x^2}, \frac{\partial^2 \dot\psi_j}{\partial x^2}\right)_B ,  
\end{align}
with $\chi_i=\phi_i$ or $\chi_i=\psi_i$, $i=1,2,\ldots,\Nn$.
This can be written as the matrix differential equation
\begin{align}
   M \ddot\uv = - B \dot\uv - K \uv + \fv , \label{eq:beamODE}
\end{align}
where $\uv$ is the vector of the degrees of freedom and 
$M$, $B$ and $K$ are $2\times2$-block tridiagonal matrices , 
\begin{align}
   \uv = \begin{bmatrix} w_1 \\ w'_1 \\ w_2 \\ w'_2 \\ \vdots \\ w_{\Nn} \\ w'_{\Nn} \end{bmatrix} , 
\quad 
   M = \begin{bmatrix} 
          B^M_1 & C^M_1 &     &      &     &     \\ 
          A^M_2 & B^M_2 & C^M_2 &      &     &     \\
              & A^M_3 & B^M_3 & C^M_3  &     &     \\
              &     & \ddots & \ddots  & \ddots  & \\
              &     &     &     & A^M_{\Nn} & B^M_{\Nn}
           \end{bmatrix} 
\quad               
   K = \begin{bmatrix} 
          B^K_1 & C^K_1 &     &      &     &     \\ 
          A^K_2 & B^K_2 & C^K_2 &      &     &     \\
              & A^K_3 & B^K_3 & C^K_3  &     &     \\
              &     & \ddots & \ddots  & \ddots  & \\
              &     &     &     & A^K_{\Nn} & B^K_{\Nn}
           \end{bmatrix} 
\end{align}
The matrices $A^M_i$, $B^M_i$, $C^M_i$,  $A^K_i$, $B^K_i$, and $C^K_i$ are two-by-two matricies, $\Real^{2\times2}$.

{\bf Note:} The FEM approximation using Hermite polynomials also solves for $w'$ and thus is effectively
an Hermite scheme (i.e. solving the PDE and the x-derivative of the PDE).

% -----------------------------------------------------------------------------------------
% Mass matrix:
%  [        13/35*le     11/210*le^2         9/70*le    -13/420*le^2]
%  [     11/210*le^2      1/105*le^3     13/420*le^2     -1/140*le^3]
%  [         9/70*le     13/420*le^2        13/35*le    -11/210*le^2]
%  [    -13/420*le^2     -1/140*le^3    -11/210*le^2      1/105*le^3]
% Tension Matrix (v_x,w_x):
%  [          6/5/le            1/10         -6/5/le            1/10]
%  [            1/10         2/15*le           -1/10        -1/30*le]
%  [         -6/5/le           -1/10          6/5/le           -1/10]
%  [            1/10        -1/30*le           -1/10         2/15*le]
% Stiffness Matrix (v_xx,w_xx):
%  [         12/le^3          6/le^2        -12/le^3          6/le^2]
%  [          6/le^2            4/le         -6/le^2            2/le]
%  [        -12/le^3         -6/le^2         12/le^3         -6/le^2]
%  [          6/le^2            2/le         -6/le^2            4/le]

\subsubsection{Element matrices}

The global mass matrix, $M$, and stiffness matrix $K$, can be computed by summing the contributions
from the element mass matrices and stiffness matrices, respectively. The entries in the global matrices are
integrals over the entire domain while the element matrices are just integrals of the same quantities but over a single element.
(See {\tt cgDoc/moving/codes/beam/beam.maple}).

The solution $w$ on an element $\Omega_i=[x_i,x_{i+1}]$ can be written as
\begin{align}
&  w(x(\xi)) =  \wv^T \Nv(\xi), \qquad \xi\in[-1,1], \\
&  \wv_i = \begin{bmatrix} 
               w_i \\  w'_i \\ w_{i+1} \\ w'_{i+1}
              \end{bmatrix},
\qquad 
\Nv(\xi) = \begin{bmatrix} 
               \frac{1}{4} (1-\xi)^2 (2+\xi) \\
               \frac{\dx}{8} (1-\xi)^2 (1+\xi) \\
               \frac{1}{4} (1+\xi)^2 (2-\xi) \\
               \frac{\dx}{8} (1+\xi)^2 (\xi-1) 
              \end{bmatrix}
  ~= \begin{bmatrix} \phi(\xi) \\ \psi(\xi) \\ \phi(-\xi) \\ -\psi(-\xi) \end{bmatrix}, \\
&  x(\xi) = x_i (1-\xi)/2 + x_{i+1}( \xi+1)/2 = x_i + \half(\xi+1)\dx , 
\end{align} 
where $\dx=x_{i+1}-x_i$ is the element length. 
% 
The $4\times 4$ element mass matrix is symmetric and given by (assuming $\rhos\As$ is constant)
\begin{align}
   M_e = \int_0^{\dx} \rhos \As \Nv \Nv^T \, dx = 
% 
\begin{bmatrix}
13\dx/35 & 11\dx^2/210 & 9\dx/70      & -13\dx^2/420 \\
         & \dx^3/105   & 13\dx^2/420  & -\dx^3/140   \\
         &             & 13\dx/35     & -11\dx^2/210 \\
         &             &              & \dx^3/105
\end{bmatrix}.
%
\end{align} 
The element stiffness matrix is also symmetric and given by  (assuming $EI$ is constant)
\begin{align}
   K_e = \int_0^{\dx} EI \, \partial_x^2\Nv \, \partial_x^2\Nv^T \, dx = 
\begin{bmatrix}
12/\dx^3 & 6/\dx^2 & -12/\dx^3 & 6/\dx^2 \\
         & 4/\dx   & -6/\dx^2  & 2/\dx   \\
         &         & 12/\dx^3  &-6/\dx^2 \\
         &         &           &4/\dx
\end{bmatrix}.
\end{align} 
The element tension matrix is also symmetric and given by 
\begin{align}
   T_e = \int_0^{\dx} T \, \partial_x\Nv \, \partial_x\Nv^T \, dx = 
T 
\begin{bmatrix}
\frac{6}{5}/\dx & \frac{1}{10} & -\frac{6}{5}/\dx & \frac{1}{10} \\
         & \frac{2}{15}\dx   & -\frac{1}{10}  & -\frac{1}{30}\dx   \\
         &         & \frac{6}{5}/\dx  &-\frac{1}{10} \\
         &         &           &\frac{2}{15}\dx
\end{bmatrix}.
\end{align} 
% 
The element force vector is 
\begin{align}
 \fv_e = \int_0^{\dx} f(x,t) \Nv dx
\end{align} 

% --------------------------------------------------------------------------------------------------------------------
\subsection{Force computation} \label{eq:BeamModel_ForceComputation}

The integrals defining the contribution of the external force are 
(see subsection~\ref{sec:projectForces} for a discussion of projecting external forces on the beam surface onto the neutral axis)
\begin{align}
& F_i^\phi  = ( \phi_i, f(x,t) )_B  = \int_0^{\Ls} \phi_i(x) f(x,t) \, dx, \label{eq:elementForcePhi} \\
& F_i^\psi =  ( \psi_i, f(x,t) )_B  = \int_0^{\Ls} \psi_i(x) f(x,t) \, dx. \label{eq:elementForcePsi}
\end{align}
or in element form
\begin{align}
 \fv_e = \int_0^{\dx} f(x(\xi),t) \Nv(\xi) (\half \dx) \, d\xi
\end{align} 
These can be approximated to second-order accuracy by representing $f(x,t)$ as a linear
function of $x$ over the element $\Omega_i$,
\begin{align}
   f(x,t) = f_i\frac{x_{i+1}-x}{\dx}  + f_{i+1} \frac{x-x_i}{\dx} ,
\end{align}
and performing the resulting integrals exactly. 

For an FSI computation the external force (e.g. pressure) is defined on a different grid. In this case we need
to sum the contributions from partial segments of the element,
\begin{align}
 \fv_e(a,b) = \int_a^{b} f(x(\xi),t) \Nv(\xi) (\half \dx) \, d\xi, \\
   f(x(\xi),t) = f_a\frac{b-\xi}{b-a}  + f_b \frac{\xi-a}{b-a} .
\end{align} 
Here $-1\le a \le b \le 1$. 

\paragraph{More accurate force computation.} If we had approximations to $f$ and $\partial_x f$ at the nodes we
could represent $f$ as an Hermite interpolant,
\begin{align}
&  f(x(\xi)) =  \fv^T \Nv(\xi) = \Nv^T\fv , \\
&  \fv_i = \begin{bmatrix} 
 f_i \\  f'_i \\ f_{i+1} \\ f'_{i+1}
              \end{bmatrix},
\end{align} 
In this case 
\begin{align}
 \fv_e &= \int_0^{\dx} \Nv(\xi) \Nv^T(\xi)  (\half \dx) \, d\xi ~\fv, \\
       &= \frac{1}{\rhos\As} \, M_e \, \fv
\end{align} 
The formulae are a bit more complicated when $f$ is defined on a sub-interval $[a,b]$ (see the Maple
code in cgDoc/moving/codes/beam/beam.maple which generates the file {\tt elementIntegrationHermiteOrder4.h} 
used by BeamModel.C)  .

% --------------------------------------------------------------------------------------------------------------------
\subsection{Computing the position, velocity and acceleration of points on the beam surface}

For finite width beams we need to be able to compute the position, velocity and acceleration
of points on the beam surfaces (as oppposed to the neutral curve). These values are used, for example,
in FSI simulations.
We also need to be able to project a force on the beam surface to a corresponding force on the
neutral curve. 

Let $\xbv(s,t)=(x(s),w(s,t))$ denote the beam neutral curve, parameterized by $s$, $0\le s \le L$.
let $\nsv(s,t)$ denote the unit normal vector to the curve. If 
\begin{align*}
   \tv(s,t)= \frac{[ x_s,w_s]^T}{\sqrt{x_s^2+w_s^2}} = \frac{[ 1,w_x]^T}{\sqrt{1+w_x^2}}
\end{align*}
is the unit tangent vector then
\begin{align*}
   \nv(s,t)= \frac{[ -w_x, 1]^T}{\sqrt{1+w_x^2}}. 
\end{align*}
Under the EB assumption the plane (curve in 2D) orthogonal to the neutral curve remains straight as the beam deforms.
In this case the curves defining the upper and lower beam surfaces $\xv_\pm$ are given by
\begin{align*}
   \xv_\pm(s,t) = \xbv(s,t) \pm \frac{\hs}{2} \nsv(s,t)
\end{align*}
The velocity of a point on the beam surface is then 
\begin{align}
   \vv_\pm(s,t) = \frac{\partial}{\partial t}\xv_\pm(s,t) =  \vv(s,t) \pm \frac{\hs}{2} \frac{\partial}{\partial t}\nsv(s,t),
       \label{eq:beamSurfaceVelocity}
\end{align}
where the time derivative of the beam normal is 
\begin{align*}
   \frac{\partial}{\partial t}\nsv(s,t) = \frac{[ -w_{xt}, 0]^T}{\sqrt{1+w_x^2}} + 
                 \frac{-w_x w_{xt} [-w_x, 1]^T}{(1+w_x^2)^{3/2}} = \frac{[ -w_{xt}, -w_x w_{xt}]^T}{(1+w_x^2)^{3/2}}
\end{align*}
where $w_{xt}=\partial_x v_2$ .
The acceleration of a point on the beam surface is
\begin{align}
   \av_\pm(s,t) = \frac{\partial}{\partial t}\vv_\pm(s,t) =  \av(s,t) \pm \frac{\hs}{2} \frac{\partial^2}{\partial t^2}\nsv(s,t),
   \label{eq:beamSurfaceAcceleration}
\end{align}
where 
\begin{align*}
   \frac{\partial^2}{\partial t^2}\nsv(s,t) % &= \frac{\partial}{\partial t} \frac{[ -w_{xt}, -w_x w_{xt}]^T}{(1+w_x^2)^{3/2}}, \\
        & = \frac{[ -w_{xtt}, -w_x w_{xtt} -w_{xt}^2 ]^T}{(1+w_x^2)^{3/2}} 
           - 3 w_x w_{xt} \frac{[ -w_{xt}, -w_x w_{xt}]^T}{(1+w_x^2)^{5/2}} .
\end{align*}
Equations~\eqref{eq:beamSurfaceVelocity} and~\eqref{eq:beamSurfaceAcceleration} can be used to compute
the velocity and acceleration of points on the beam's upper and lower surfaces.

% --------------------------------------------------------------------------------------------------------------------
\subsection{Transfering surface forces onto the neutral axis} \label{sec:projectForces}

    When the external force on the beam arises from an FSI simulation, the fluid traction $\sigmav\nv$ will be applied
at some point $\xv_p$ on the surface of the beam. In this case we need to project the force onto the beam neutral axis. 

Given a point $\xv_p$ on the top beam surface, 
and fluid force $\fv_p$ at this point, we determine $s$ so that $\xv_p = \xv_+(s,t)$ and then
the force on the neutral axis is applied at this value of $s$, i.e. at the point $\xbv(s,t)$ on the neutral axis.
Similarly for a point on the lower beam surface $\xv_-$. 

The force on the beam, as appears in the EB beam equation~\eqref{eq:BeamModel} is then taken as as the normal component of the fluid force, 
CHECK THIS
\begin{align*}
    f(s,t) = \nv(s,t)^T\fv_p
\end{align*}
 -- or do we use
\begin{align*}
    f(s,t) = \nv_+(s,t)^T\fv_p
\end{align*}
where $\nv_+(s,t)$ is the normal to the top beam surface. 

QUESTION: Since the beam acceleration is related to the surface acceleration by~\eqref{eq:beamSurfaceAcceleration}
should we adjust the fluid force by some factor of $(\hs/2)\partial_t^2\nv$ ??

% --------------------------------------------------------------------------------------------------------------------
\subsection{Transfering and projecting surface velocities onto the neutral axis} \label{sec:projectVelocity}

In FSI simulations we may want to assign the beam velocity $\vv(s,t)$ on the neutral axis to match
given values of the velocity on the beam surface (e.g. for the velocity projection step of the AMP scheme). 
%
The velocity of a point on the beam surface is related to the velocity of the neutral axis by
\begin{align}
   \vv_\pm(s,t) =  \vv(s,t) \pm \frac{\hs}{2} \frac{\partial}{\partial t}\nsv(s,t).
\end{align}
Given the values of the positions, $\xv_\pm^0(s)$, and velocity $\vv_\pm^0(s)$, 
on the beam surface (e.g. from the AMP velocity projection step) , we can compute estimated velocities on the neutral
surface $\vv_\pm^b$ from
\begin{align}
   \vv_\pm^b   = \vv_\pm^0 \mp \frac{\hs}{2} \frac{\partial}{\partial t}\nsv(s,t).
\end{align}
and then set
\begin{align}
   \vv(s,t)   = \half( \vv_+^b + \vv_-^b ). 
\end{align}
If the beam only has fluid on one side then we would set $\vv(s,t)=\vv_+^b$ or $\vv(s,t)=\vv_-^b$.

The projection of pointwise values of the velocity on the beam neutral surface
onto the Hermite FEM representation follows the steps discussed in Section~\ref{eq:BeamModel_ForceComputation}.

Given a representation of the normal component of the 
velocity on the neutral surface as a function $v=v(x)$ a Galerkin projection can be used to determine the
coefficients in the FEM representation,
\begin{align}
  v(x) \approx v^h(x,t) = \sum_{j=1}^{\Nn} v_j \phi_j(x) + v_j' \psi_j(x) 
\end{align}
by computing the coefficients $v_j$ and $v_j'$ from the equations 
\begin{align}
  \sum_{j=1}^{\Nn} v_j (\phi_i(x),\phi_j(x))_B + v_j' (\phi_i(x),\psi_j(x))_B &= (\phi_i,v)_B \equiv f_i , \\
  \sum_{j=1}^{\Nn} v_j (\psi_i(x),\phi_j(x))_B + v_j' (\psi_i(x),\psi_j(x))_B &=  (\psi_i,v)_B  \equiv f_i',
\end{align}
i.e. from the matrix system
\begin{align}
   M_0 \begin{bmatrix} v_1 \\ v_1' \\ v_2 \\ v_2' \\ \vdots \end{bmatrix}
       =  \begin{bmatrix} f_1 \\ f_1' \\ f_2 \\ f_2' \\ \vdots \end{bmatrix} .
\end{align}


QUESTION: If the beam has a rounded end, what should we do with the velocities on the rounded end? Maybe just ignore
these. 


% --------------------------------------------------------------------------------------------------------------------
\subsection{Time-stepping}
The Newmark-beta scheme for the matrix ODE 
\begin{align*}
   M \ddot\uv = -B \dot\uv - K \uv + \fv ,
\end{align*}
is an implicit scheme defined by
\begin{align*}
 &  \uv^{n+1} = \uv^n + \dt\vv^n + \frac{\dt^2}{2}\Big[ (1-2\beta) \av^n + 2\beta \av^{n+1} \Big],  \\
 &  \vv^{n+1} = \vv^n + \dt\Big[  (1-\gamma) \av^n + \gamma \av^{n+1} \Big]    , \\
 &  M \av^{n+1} = -B \vv^{n+1} -K \uv^{n+1} + \fv^{n+1} .
\end{align*}
where $\uv^n$ is the displacement, $\vv^n$ the velocity and $\av^n$ the acceleration at time $t^n$. 
Each time step requires the solution of the implicit system
\begin{align}
 &  \Big[ M + \gamma\dt B + \beta\dt^2 K \Big] \av^{n+1} =
      \fv^{n+1} 
      - B \Big[ \vv^n + (1-\gamma) \dt \av^n \Big] 
      - K\Big[ \uv^n + \dt\vv^n + \frac{\dt^2}{2} (1-2\beta) \av^n \Big] 
   \label{eq:NewmarkMatrix}
\end{align}
to determine the acceleration $\av^{n+1}$. 
The scheme is second-order accurate and unconditionally stable for $2\beta=\half$ and $\gamma=\half$. 

% --------------------------------------------------------------------------------------------------------------------
\newcommand{\uHat}{\hat{u}}
\newcommand{\vHat}{\hat{v}}
\newcommand{\Ahat}{\hat{A}}
\newcommand{\Bhat}{\hat{B}}
\newcommand{\lambdaHat}{\hat{\lambda}}
\subsection{Time-step determination}


We start by considering the time-step determination for a method-of-lines time-stepping
algorithm such as Runge-Kutta.
After Fourier transforming in space the beam equations are
\begin{align*}
 \rhos\As \vHat_{t} &= - (K_0 + k^2\Ts + k^4 E I )\uHat - (K_t+ k^2 K_{xxt}) \vHat, \\
  \uHat_t &= \vHat
\end{align*}
or
\begin{align*}
 \begin{bmatrix} \uHat\\ \vHat \end{bmatrix}_t = 
      \begin{bmatrix}
            0 & 1 \\
           -A & -B
      \end{bmatrix}
 \begin{bmatrix} \uHat\\ \vHat\end{bmatrix}     = C \begin{bmatrix} \uHat\\ \vHat\end{bmatrix} , 
\end{align*}
where
\begin{align*}
  A &= (K_0 + k^2\Ts + k^4 E I)/(\rhos\As), \\
  B &= (K_t+ k^2 K_{xxt})/(\rhos\As). 
\end{align*}
The eigenvalues of the matrix $C$ are 
\begin{align*}
  \lambda = \frac{B}{2} \pm \sqrt{ \left(\frac{B}{2}\right)^2 - A} .
\end{align*}
\noindent{\bf Case 1 (under-damped):} When $\left(\frac{B}{2}\right)^2 - A <0$ the eigenvalues are complex and
\begin{align*}
  \lambda = \frac{B}{2} \pm i \sqrt{ A - \left(\frac{B}{2}\right)^2} .
\end{align*}

\noindent{\bf Case 1 (over-damped):} When $\left(\frac{B}{2}\right)^2 - A >0$ the eigenvalues are real
\begin{align*}
  \lambda = \frac{B}{2} \pm \sqrt{ \left(\frac{B}{2}\right)^2 - A}.
\end{align*}

In the discrete case the time-stepping eigenvalues are of the same form
\begin{align*}
  \lambdaHat = \frac{\Bhat}{2} \pm \sqrt{ \left(\frac{\Bhat}{2}\right)^2 - \Ahat} ,
\end{align*}
where for a second-order accurate central finite difference approximation we could choose
\begin{align*}
  \Ahat &= K_0 + \Ts\frac{4}{\dx^2} + E I\frac{16}{\dx^4}, \\
  \Bhat &= K_t+ K_{xxt}\frac{4}{\dx^2} ,
\end{align*}
assuming the plus-minus mode is the worst case.

For stability we require $\lambdaHat\dt$ to be in the region of absolute stability of the time-stepping
algorithm.
If we approximate the region of absolute stability by the ellipse
\begin{align*}
   \left(\frac{\Re\lambdaHat\dt}{\alpha}\right)^2  + \left(\frac{\Im\lambdaHat\dt}{\beta}\right)^2 \le 1,
\end{align*}
then we arrive at the time-step restriction
\begin{align*}
   \dt \le \frac{C_\text{cfl}}{\sqrt{ \left(\frac{\Re\lambdaHat}{\alpha}\right)^2  + \left(\frac{\Im\lambdaHat}{\beta}\right)^2}}. 
\end{align*}
where $C_\text{cfl}$ is the CFL number. In practice we might choose $C_\text{cfl}=0.9$. 
% --------------------------------------------------------------------------------------------------------------------
\subsection{Implementing the boundary conditions} \label{eq:BeamModel_FEM_BC}

We describe some of the details involved in implementing the BC's. We consider the 
boundary at $x=0$, the case of $x=L$ is similar. 

\paragraph{Clamped boundary condition.} For clamped BC's at $x=0$ we set the two degrees of
freedom at $j=1$ to be given
\begin{align}
  w_1 = g_0(t), \qquad w'_1(t)=h_0(t).
\end{align}
The {\em second-time derivative} of these equations replace the first two equations in the system~\eqref{eq:beamODE}. 
Thus we set 
\begin{align*}
&  B_1^M=I, \quad C_1^M=0, \quad B^F_1=0, \quad C^F_1=0 , \\
&  [f_1, ~f_2]=[\partial_t^2g_0(t), ~\partial_t^2 h_0(t)].
\end{align*}
The boundary terms in~\eqref{eq:beamFEM_II} at $x=0$ will vanish for equations $i=2,3,\ldots$ 
since $\chi_i(0)=0$ and $\partial_x\chi_i(0)=0$
for $i\ne 1$.

\paragraph{Pinned boundary condition.} For pinned BC's at $x=0$ we set one degree of
freedom at $j=1$ to be given
\begin{align}
  w_1 = g_0(t) .
\end{align}
The {\em second-time derivative} of this equation will replace the first equation in the system~\eqref{eq:beamODE} (as for
the clamped BC).  
We also need to impose
\begin{align}
  EI \partial_x^2 w_1 = M(t). 
\end{align}
This condition is a natural boundary condition and appears in the boundary terms in~\eqref{eq:beamFEM_II}, 
\begin{align}
   \Bc(\chi_i) = -\left[ \chi_i T \frac{\partial w^h}{\partial x} 
                     ~ + \chi_i K_{xxt} \frac{\partial \dot w^h}{\partial x}
                     ~ - \chi_i \frac{\partial}{\partial x}\Big( E I \frac{\partial^2 w^h}{\partial x^2}\Big) 
                      ~ + \frac{\partial \chi_i}{\partial x}E I \frac{\partial^2 w^h}{\partial x^2}\Big)  
                      \right]_0 ~.
\end{align}
The boundary term will contribute to the second equation, 
\begin{align}
   \Bc(\psi_1) &= -\left[ \psi_1 T \frac{\partial w^h}{\partial x} 
                      ~ + \psi_1 K_{xxt} \frac{\partial \dot w^h}{\partial x}
                      ~ - \psi_1 \frac{\partial}{\partial x}\Big( E I \frac{\partial^2 w^h}{\partial x^2}\Big) 
                      ~ + \frac{\partial \psi_1}{\partial x} M(t)  
                      \right]_0, \\
        &= -M(t) 
\end{align}
since $\psi_1(0)=0$, and $\partial_x\psi_1(0)=1$. 

\paragraph{Free boundary condition.} For a free BC we impose
\begin{align}
&    E I w_{xx}(0,t)=M(t), \\
&   \partial_x( E I w_{xx})(0,t)=S(t) .
\end{align}
These two natural BC's contribute to the boundary terms.
The first equation will have the contribution (using $\phi_1(0)=1$, $\partial_x\phi_1(0)=0$)
\begin{align}
   \Bc(\phi_1) &= -\left[ \phi_1 T \frac{\partial w^h}{\partial x} 
                      ~ + \phi_1 K_{xxt} \frac{\partial \dot w^h}{\partial x}  
                      ~ - \phi_1 \frac{\partial}{\partial x}\Big( E I \frac{\partial^2 w^h}{\partial x^2}\Big) 
                      ~ + \frac{\partial \phi_1}{\partial x}E I \frac{\partial^2 w^h}{\partial x^2}\Big)  
                      \right]_0  \\
     &=  -T w'_1 - K_{xxt} \dot w'_1  + S(t) . \label{eq:beam:pinned}
\end{align}
since $\phi_1(0)=1$, $\partial_x\phi_1(0)=0$.
Note that the terms $T w'_1$ and $- K_{xxt} \dot w'_1$
in equation~\eqref{eq:beam:pinned} will contribute an adjustment to the stiffness matrix
and will thus change the implicit matrix~\eqref{eq:NewmarkMatrix} in the Newmark scheme.


The second equation in our system will have the contribution 
\begin{align}
   \Bc(\psi_1) &= -\left[\psi_1 T \frac{\partial w^h}{\partial x} 
                      ~ + \psi_1 K_{xxt} \frac{\partial \dot w^h}{\partial x} 
                      ~ - \psi_1 \frac{\partial}{\partial x}\Big( E I \frac{\partial^2 w^h}{\partial x^2}\Big) 
                      ~ + \frac{\partial \psi_1}{\partial x}E I \frac{\partial^2 w^h}{\partial x^2}\Big)  
                      \right]_0 \\
        &= - M(t) , 
\end{align}
since $\psi_1(0)=0$, $\partial_x\psi_1(0)=1$.

{\bf Note:} The case of $E I= 0$ (i.e. the wave equation for a {\em string}) 
is a special case since the order of the PDE in space goes from four to two. In this
case there is only one BC applied at each end -- currently only the Dirichlet case
is implemented usng the {\em pinned} BC. 



% --------------------------------------------------------------------------------------------------------------------
% --------------------------------------------------------------------------------------------------------------------
\clearpage
\subsection{BeamModel Numerical results} \label{eq:BeamModel_Results}


Here are some numerical results for the BeamModel.


% --------------------------------------------------------------------------------------------------------------------
\subsubsection{Twilight-zone with second-order accurate force integration} 

Tables ?? show results for a trigonometric TZ solution for different boundary conditions, c=clamped, p=pinned, f=free.
The results show that the scheme is second-order accurate. 
The scheme is 4th-order in space but the force integration (used to compute the element
force integrals~\eqref{eq:elementForcePhi}-\eqref{eq:elementForcePsi} )is only done to second-order.

{
\input results/tbm.linearBeam.c.trig.ConvTable.tex 
\input results/tbm.linearBeam.p.trig.ConvTable.tex 
\input results/tbm.linearBeam.f.trig.ConvTable.tex 
}


% --------------------------------------------------------------------------------------------------------------------
\subsubsection{Twilight-zone with fourth-order accurate force integration} 

Tables ?? show results for a trigonometric TZ solution for different boundary conditions, c=clamped, p=pinned, f=free.
The results show that the scheme is fourth-order accurate when computing the
element
force integrals~\eqref{eq:elementForcePhi}-\eqref{eq:elementForcePsi} to 4-th order.
The scheme is second-order in time but we take $\dt \propto \dx^2$. 

NOTE: The scheme is exact for degreeX=4, degreeT=1, when $T \ne 0$, $E\ne 0$, since the TZ forcing is a quadratic in space
and the fouth-order force integration will be exact.

{
\input results/tbm.linearBeam.c.beamOGP4.trig.ConvTable.tex
\input results/tbm.linearBeam.p.beamOGP4.trig.ConvTable.tex
\input results/tbm.linearBeam.f.beamOGP4.trig.ConvTable.tex
}


\clearpage
% --------------------------------------------------------------------------------------------------------------------
\subsubsection{Standing wave} 

An exact standing wave solution is given by
\begin{align*}
   w(x,t) = \alpha \sin(k x)\cos(\omega t) .
\end{align*}
Given $k$, $\omega$ is 
\begin{align*}
   \omega =\sqrt{ \frac{E I k^4 + T k^2}{\rhos\As} } .
\end{align*}
Convergence results are given in Table~\ref{table:tbm.linearBeam.p.sw} for $k=2\pi$, $E I=1$, $\rhos\As=10$.
The errors converge close to fourth-order accuracy. The time-stepping scheme is second-order but 
we choose $\dt \propto \dx^2$, which leads to the fourth-order convergence.

\input results/tbm.linearBeam.p.sw.ConvTable.tex



%\clearpage
%\bibliography{\homeHenshaw/papers/henshaw}
%\bibliographystyle{plain}
\end{document}
